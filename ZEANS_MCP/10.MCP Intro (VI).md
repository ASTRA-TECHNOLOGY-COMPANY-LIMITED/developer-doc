# T·ªïng quan v·ªÅ Giao th·ª©c Ng·ªØ c·∫£nh M√¥ h√¨nh (MCP) v√† Chi ti·∫øt Giao th·ª©c

T√†i li·ªáu n√†y gi·∫£i th√≠ch c√°c kh√°i ni·ªám c∆° b·∫£n, c√°c th√†nh ph·∫ßn (m√°y ch·ªß, m√°y kh√°ch, m√°y ph·ª•c v·ª•), l∆∞·ª£c ƒë·ªì tin nh·∫Øn v√† lu·ªìng giao th·ª©c c·ªßa Giao th·ª©c Ng·ªØ c·∫£nh M√¥ h√¨nh (MCP). N√≥ c≈©ng ƒë·ªÅ c·∫≠p ng·∫Øn g·ªçn v·ªÅ SDK v√† c√°c v√≠ d·ª• m√£ ngu·ªìn m·ªü ƒë·ªÉ gi√∫p b·∫°n d·ªÖ d√†ng b·∫Øt ƒë·∫ßu.

---

## M·ª•c l·ª•c

1. [T·ªïng quan v·ªÅ MCP](#t·ªïng-quan-v·ªÅ-mcp)
2. [ƒê·ªãnh nghƒ©a Vai tr√≤: M√°y ch·ªß, M√°y kh√°ch, M√°y ph·ª•c v·ª•](#ƒë·ªãnh-nghƒ©a-vai-tr√≤-m√°y-ch·ªß-m√°y-kh√°ch-m√°y-ph·ª•c-v·ª•)
3. [L∆∞·ª£c ƒë·ªì Tin nh·∫Øn MCP](#l∆∞·ª£c-ƒë·ªì-tin-nh·∫Øn-mcp)
    - [C·∫•u tr√∫c D·ª±a tr√™n JSON-RPC](#c·∫•u-tr√∫c-d·ª±a-tr√™n-json-rpc)
    - [C√°c Lo·∫°i Tin nh·∫Øn Ch√≠nh v√† V√≠ d·ª•](#c√°c-lo·∫°i-tin-nh·∫Øn-ch√≠nh-v√†-v√≠-d·ª•)
        - [Kh·ªüi t·∫°o v√† Qu·∫£n l√Ω Phi√™n](#kh·ªüi-t·∫°o-v√†-qu·∫£n-l√Ω-phi√™n)
        - [Tin nh·∫Øn Li√™n quan ƒë·∫øn Prompt](#tin-nh·∫Øn-li√™n-quan-ƒë·∫øn-prompt)
        - [Tin nh·∫Øn Li√™n quan ƒë·∫øn T√†i nguy√™n](#tin-nh·∫Øn-li√™n-quan-ƒë·∫øn-t√†i-nguy√™n)
        - [Tin nh·∫Øn Li√™n quan ƒë·∫øn C√¥ng c·ª•](#tin-nh·∫Øn-li√™n-quan-ƒë·∫øn-c√¥ng-c·ª•)
        - [T·∫°o Ph·∫£n h·ªìi LLM (L·∫•y m·∫´u)](#t·∫°o-ph·∫£n-h·ªìi-llm-l·∫•y-m·∫´u)
        - [Tin nh·∫Øn Li√™n quan ƒë·∫øn Root](#tin-nh·∫Øn-li√™n-quan-ƒë·∫øn-root)
4. [Lu·ªìng Giao th·ª©c (S∆° ƒë·ªì)](#lu·ªìng-giao-th·ª©c-s∆°-ƒë·ªì)
5. [SDK v√† C√¥ng c·ª• M√£ ngu·ªìn M·ªü](#sdk-v√†-c√¥ng-c·ª•-m√£-ngu·ªìn-m·ªü)

---

## T·ªïng quan v·ªÅ MCP

Giao th·ª©c Ng·ªØ c·∫£nh M√¥ h√¨nh (MCP) l√† m·ªôt **giao th·ª©c truy·ªÅn th√¥ng chu·∫©n h√≥a** ƒë·ªÉ k·∫øt n·ªëi M√¥ h√¨nh Ng√¥n ng·ªØ L·ªõn (LLM) v·ªõi c√°c ngu·ªìn d·ªØ li·ªáu ho·∫∑c c√¥ng c·ª• b√™n ngo√†i (h·ªá th·ªëng t·ªáp, c∆° s·ªü d·ªØ li·ªáu, API, v.v.).  
M·ª•c ƒë√≠ch ch√≠nh l√† cho ph√©p c√°c ·ª©ng d·ª•ng LLM nh·∫≠n ƒë∆∞·ª£c ng·ªØ c·∫£nh b·ªï sung c·∫ßn thi·∫øt (d·ªØ li·ªáu, prompt, k·∫øt qu·∫£ c√¥ng c·ª•, v.v.) theo c√°ch chu·∫©n h√≥a.

---

## ƒê·ªãnh nghƒ©a Vai tr√≤: M√°y ch·ªß, M√°y kh√°ch, M√°y ph·ª•c v·ª•

-   **M√°y ch·ªß (Host)**

    -   **ƒê·ªãnh nghƒ©a:** B·∫£n th√¢n ·ª©ng d·ª•ng ho·∫∑c c√¥ng c·ª• LLM (v√≠ d·ª•: chatbot AI, ti·ªán √≠ch m·ªü r·ªông IDE, v.v.).
    -   **Vai tr√≤:** ƒêi·ªÅu ph·ªëi to√†n b·ªô y√™u c·∫ßu v√† thu th·∫≠p ng·ªØ c·∫£nh b√™n ngo√†i ƒë·ªÉ chuy·ªÉn ƒë·∫øn m√¥ h√¨nh.

-   **M√°y kh√°ch (Client)**

    -   **ƒê·ªãnh nghƒ©a:** M√¥-ƒëun truy·ªÅn th√¥ng MCP chuy√™n d·ª•ng trong m√°y ch·ªß, x·ª≠ l√Ω trao ƒë·ªïi tin nh·∫Øn JSON-RPC v·ªõi m√°y ph·ª•c v·ª• MCP.
    -   **Vai tr√≤:** Qu·∫£n l√Ω k·∫øt n·ªëi gi·ªØa m√°y ch·ªß v√† m√°y ph·ª•c v·ª• MCP, v√† truy·ªÅn tin nh·∫Øn y√™u c·∫ßu/ph·∫£n h·ªìi.

-   **M√°y ph·ª•c v·ª• (Server)**

    -   **ƒê·ªãnh nghƒ©a:** M·ªôt d·ªãch v·ª• b·ªôc l·ªô d·ªØ li·ªáu ho·∫∑c c√¥ng c·ª• b√™n ngo√†i (v√≠ d·ª•: h·ªá th·ªëng t·ªáp, API, m√¥ h√¨nh Vision, v.v.) th√¥ng qua giao di·ªán MCP.
    -   **Vai tr√≤:** Ho·∫°t ƒë·ªông nh∆∞ m·ªôt "nh√† cung c·∫•p th√¥ng tin" t·∫°o ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu ƒë·ªÉ cung c·∫•p ng·ªØ c·∫£nh cho LLM.

-   **T√≥m t·∫Øt Vai tr√≤ Th√†nh ph·∫ßn MCP**

| Th√†nh ph·∫ßn          | M√¥ t·∫£ Vai tr√≤                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------- |
| **M√°y ch·ªß MCP**     | üß† **Ch·ªçn/K·∫øt h·ª£p** m√°y ph·ª•c v·ª• v√† prompt MCP ph√π h·ª£p d·ª±a tr√™n y√™u c·∫ßu ng√¥n ng·ªØ t·ª± nhi√™n c·ªßa ng∆∞·ªùi d√πng |
| **M√°y kh√°ch MCP**   | üîå **X·ª≠ l√Ω Truy·ªÅn th√¥ng** g·ª≠i tin nh·∫Øn ƒë·∫øn v√† nh·∫≠n ph·∫£n h·ªìi t·ª´ m√°y ph·ª•c v·ª• d·ª±a tr√™n giao th·ª©c MCP       |
| **M√°y ph·ª•c v·ª• MCP** | üì¶ **Nh√† cung c·∫•p D·ªØ li·ªáu/Ch·ª©c nƒÉng** ƒë·ªãnh nghƒ©a v√† cung c·∫•p prompt, c√¥ng c·ª•, t√†i nguy√™n, v.v.          |

> **V√≠ d·ª• (·ª®ng d·ª•ng Ph√¢n t√≠ch ·∫¢nh d·ª±a tr√™n ·ª®ng d·ª•ng Di ƒë·ªông)**
>
> -   **·ª®ng d·ª•ng Di ƒë·ªông (Frontend):** Vai tr√≤ giao di·ªán ng∆∞·ªùi d√πng ƒë∆°n gi·∫£n, kh√¥ng ƒë∆∞·ª£c bao g·ªìm tr·ª±c ti·∫øp trong c·∫•u tr√∫c MCP
> -   **M√°y ch·ªß Backend:** Ho·∫°t ƒë·ªông nh∆∞ **M√°y ch·ªß** MCP v√† giao ti·∫øp n·ªôi b·ªô v·ªõi b√™n ngo√†i (v√≠ d·ª•: m√°y ph·ª•c v·ª• l∆∞u tr·ªØ ·∫£nh MCP) th√¥ng qua **M√°y kh√°ch** MCP
> -   **M√°y ch·ªß L∆∞u tr·ªØ/Ph√¢n t√≠ch ·∫¢nh:** **M√°y ph·ª•c v·ª•** MCP cung c·∫•p si√™u d·ªØ li·ªáu ·∫£nh ho·∫∑c k·∫øt qu·∫£ m√¥ h√¨nh Vision

---

## L∆∞·ª£c ƒë·ªì Tin nh·∫Øn MCP

MCP trao ƒë·ªïi tin nh·∫Øn d·ª±a tr√™n ti√™u chu·∫©n JSON-RPC 2.0. T·∫•t c·∫£ tin nh·∫Øn tu√¢n theo c·∫•u tr√∫c c∆° b·∫£n sau.

### C·∫•u tr√∫c D·ª±a tr√™n JSON-RPC

-   **Tr∆∞·ªùng Chung:**
    -   `"jsonrpc": "2.0"`
    -   Y√™u c·∫ßu bao g·ªìm c√°c tr∆∞·ªùng `"id"`, `"method"` v√† `"params"`
    -   Ph·∫£n h·ªìi bao g·ªìm `"id"` c·ªßa y√™u c·∫ßu c√πng v·ªõi tr∆∞·ªùng `"result"` ho·∫∑c `"error"`
    -   Th√¥ng b√°o ƒë∆∞·ª£c g·ª≠i kh√¥ng c√≥ `"id"` v√† kh√¥ng c√≥ ph·∫£n h·ªìi

### C√°c Lo·∫°i Tin nh·∫Øn Ch√≠nh v√† V√≠ d·ª•

#### Kh·ªüi t·∫°o v√† Qu·∫£n l√Ω Phi√™n

-   **Y√™u c·∫ßu Kh·ªüi t·∫°o:**  
    Y√™u c·∫ßu k·∫øt n·ªëi ban ƒë·∫ßu v·ªõi m√°y ph·ª•c v·ª• bao g·ªìm phi√™n b·∫£n giao th·ª©c, kh·∫£ nƒÉng v√† th√¥ng tin m√°y kh√°ch.

    ```json
    {
        "jsonrpc": "2.0",
        "id": "init1",
        "method": "initialize",
        "params": {
            "protocolVersion": "2024-11-05",
            "capabilities": { "roots": { "listChanged": true }, "sampling": {} },
            "clientInfo": { "name": "SomeClient", "version": "1.2.3" }
        }
    }
    ```

-   **Ph·∫£n h·ªìi Kh·ªüi t·∫°o:**
    ```json
    {
        "jsonrpc": "2.0",
        "id": "init1",
        "result": {
            "protocolVersion": "2024-11-05",
            "capabilities": { "prompts": { "listChanged": true }, "tools": {} },
            "serverInfo": { "name": "MyServer", "version": "0.8.15" }
        }
    }
    ```

#### Tin nh·∫Øn Li√™n quan ƒë·∫øn Prompt

-   **Li·ªát k√™ Prompt:**
    ```json
    {
        "jsonrpc": "2.0",
        "id": 1,
        "method": "prompts/list",
        "params": { "cursor": "optional-cursor-value" }
    }
    ```
-   **Ph·∫£n h·ªìi Li·ªát k√™ Prompt:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 1,
        "result": {
            "prompts": [
                {
                    "name": "code_review",
                    "description": "Ph√¢n t√≠ch ch·∫•t l∆∞·ª£ng m√£ v√† ƒë·ªÅ xu·∫•t c·∫£i ti·∫øn",
                    "arguments": [
                        {
                            "name": "code",
                            "description": "M√£ ngu·ªìn c·∫ßn xem x√©t",
                            "required": true
                        }
                    ]
                },
                {
                    "name": "summarize_text",
                    "description": "T√≥m t·∫Øt m·ªôt t√†i li·ªáu vƒÉn b·∫£n ƒë√£ cho",
                    "arguments": [
                        {
                            "name": "text",
                            "description": "VƒÉn b·∫£n c·∫ßn t√≥m t·∫Øt",
                            "required": true
                        }
                    ]
                }
            ],
            "nextCursor": null
        }
    }
    ```

-   **L·∫•y Prompt:**
    ```json
    {
        "jsonrpc": "2.0",
        "id": 2,
        "method": "prompts/get",
        "params": {
            "name": "code_review",
            "arguments": { "code": "def hello():\n    print('world')" }
        }
    }
    ```
-   **Ph·∫£n h·ªìi L·∫•y Prompt:**
    ```json
    {
        "jsonrpc": "2.0",
        "id": 2,
        "result": {
            "description": "Prompt xem x√©t m√£",
            "messages": [
                {
                    "role": "user",
                    "content": {
                        "type": "text",
                        "text": "Vui l√≤ng xem x√©t m√£ sau v√† ƒë·ªÅ xu·∫•t c·∫£i ti·∫øn:\n\n{{code}}"
                    }
                }
            ]
        }
    }
    ```

#### Tin nh·∫Øn Li√™n quan ƒë·∫øn T√†i nguy√™n

-   **Li·ªát k√™ T√†i nguy√™n:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 10,
        "method": "resources/list",
        "params": { "cursor": "optional-cursor-value" }
    }
    ```

-   **ƒê·ªçc T√†i nguy√™n:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 11,
        "method": "resources/read",
        "params": { "uri": "file:///project/src/main.rs" }
    }
    ```

#### Tin nh·∫Øn Li√™n quan ƒë·∫øn C√¥ng c·ª•

-   **Li·ªát k√™ C√¥ng c·ª•:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 20,
        "method": "tools/list",
        "params": { "cursor": "optional-cursor-value" }
    }
    ```

-   **G·ªçi C√¥ng c·ª•:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 21,
        "method": "tools/call",
        "params": {
            "name": "get_weather",
            "arguments": { "location": "New York" }
        }
    }
    ```

#### T·∫°o Ph·∫£n h·ªìi LLM (L·∫•y m·∫´u; sampling/createMessage)

-   **Y√™u c·∫ßu T·∫°o Tin nh·∫Øn LLM:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 5,
        "method": "sampling/createMessage",
        "params": {
            "messages": [
                {
                    "role": "user",
                    "content": { "type": "text", "text": "Th·ªß ƒë√¥ c·ªßa Ph√°p l√† g√¨?" }
                }
            ],
            "modelPreferences": {
                "hints": [{ "name": "claude-3-sonnet" }],
                "intelligencePriority": 0.8,
                "speedPriority": 0.5
            },
            "systemPrompt": "B·∫°n l√† m·ªôt tr·ª£ l√Ω h·ªØu √≠ch.",
            "maxTokens": 100
        }
    }
    ```

-   **V√≠ d·ª• Ph·∫£n h·ªìi LLM:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 5,
        "result": {
            "role": "assistant",
            "content": { "type": "text", "text": "Th·ªß ƒë√¥ c·ªßa Ph√°p l√† Paris." },
            "model": "claude-3-sonnet-20240307",
            "stopReason": "endTurn"
        }
    }
    ```

#### Tin nh·∫Øn Li√™n quan ƒë·∫øn Root

-   **Li·ªát k√™ Root:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 30,
        "method": "roots/list"
    }
    ```

-   **V√≠ d·ª• Ph·∫£n h·ªìi Root:**

    ```json
    {
        "jsonrpc": "2.0",
        "id": 30,
        "result": {
            "roots": [{ "uri": "file:///home/user/projects/myproject", "name": "D·ª± √°n c·ªßa T√¥i" }]
        }
    }
    ```

## Lu·ªìng Giao th·ª©c (S∆° ƒë·ªì)

```mermaid
flowchart TD
    A[M√°y kh√°ch: G·ª≠i y√™u c·∫ßu kh·ªüi t·∫°o]
    B[M√°y ph·ª•c v·ª•: G·ª≠i ph·∫£n h·ªìi kh·ªüi t·∫°o]
    C[M√°y kh√°ch: G·ª≠i ho√†n th√†nh kh·ªüi t·∫°o]
    D[M√°y kh√°ch: Y√™u c·∫ßu danh s√°ch prompt/t√†i nguy√™n/c√¥ng c·ª•]
    E[M√°y ph·ª•c v·ª•: G·ª≠i ph·∫£n h·ªìi danh s√°ch]
    F[M√°y kh√°ch: G·ªçi prompt/t√†i nguy√™n/c√¥ng c·ª• ƒë∆∞·ª£c y√™u c·∫ßu]
    G[M√°y kh√°ch: G·ª≠i y√™u c·∫ßu sampling/createMessage]
    H[M√°y ch·ªß: So·∫°n tin nh·∫Øn v·ªõi ng·ªØ c·∫£nh b√™n ngo√†i]
    I[LLM: T·∫°o ph·∫£n h·ªìi d·ª±a tr√™n tin nh·∫Øn v√† ng·ªØ c·∫£nh]
    J[M√°y kh√°ch: Nh·∫≠n v√† chuy·ªÉn ph·∫£n h·ªìi LLM]

    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
    G --> H
    H --> I
    I --> J
```

## SDK v√† C√¥ng c·ª• M√£ ngu·ªìn M·ªü

-   **SDK:**

    -   [SDK MCP cho Python](https://github.com/your-project/mcp-sdk-python)
    -   [SDK MCP cho JavaScript](https://github.com/your-project/mcp-sdk-js)
    -   [SDK MCP cho Java](https://github.com/your-project/mcp-sdk-java)

-   **C√¥ng c·ª• M√£ ngu·ªìn M·ªü:**
    -   [D·ª± √°n V√≠ d·ª• MCP](https://github.com/your-project/mcp-example-project)
    -   [H∆∞·ªõng d·∫´n T√≠ch h·ª£p MCP](https://github.com/your-project/mcp-integration-guide)
